ct mark & MARK == MARK masquerade
ct mark != MARK update @persist-persistence-priority--http { tcp sport : ct mark }
ct mark set tcp sport map @static-sessions-persistence-priority--http accept
ct state new ct mark MARK ct mark set numgen inc mod 1 map { 0 : MARK }
ct state new ct mark MARK ct mark set numgen inc mod 1 map { 0 : MARK }
ct state new ct mark MARK ct mark set numgen inc mod 1 map { 0 : MARK }
ct state new ct mark MARK ct mark set numgen inc mod 1 map { 0 : MARK }
ct state new ct mark MARK ct mark set numgen inc mod 1 map { 0 : MARK }
ct state new ct mark set tcp sport map @persist-persistence-priority--http
dnat ip addr . port to ct mark map { MARK : IP . 53 }
dnat ip addr . port to ct mark map { MARK : IP . 53 }
dnat ip addr . port to ct mark map { MARK : IP . 80 }
dnat ip addr . port to ct mark map { MARK : IP . 8443 }
dnat ip addr . port to ct mark map { MARK : IP . 9153 }
ip protocol . ip daddr . th dport vmap @filter-proto-services
ip protocol . ip daddr . th dport vmap @nat-proto-services
ip protocol . ip daddr . th dport vmap @output-filter-proto-services
ip protocol . ip daddr . th dport vmap @output-nat-proto-services
meta mark set ct mark
snat to ct mark map @proto-services-back-m